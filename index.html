<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››æŸ±å…«å­—æ’ç›˜ç³»ç»Ÿ - ä¸“ä¸šç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.js"></script>
    <style>
        body { 
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .gan { font-weight: bold; }
        .zhi { font-weight: bold; }
        
        /* äº”è¡Œç€è‰² */
        .wuxing-é‡‘ { color: #d97706; }
        .wuxing-æœ¨ { color: #16a34a; }
        .wuxing-æ°´ { color: #2563eb; }
        .wuxing-ç« { color: #dc2626; }
        .wuxing-åœŸ { color: #78350f; }
        
        .interaction-tag {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 4px;
            margin-bottom: 2px;
            display: inline-block;
            font-weight: 500;
        }
        .tag-chong { background-color: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
        .tag-he { background-color: #dcfce7; color: #166534; border: 1px solid #86efac; }
        .tag-xing { background-color: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }
        .tag-hai { background-color: #e0e7ff; color: #3730a3; border: 1px solid #a5b4fc; }
        .tag-po { background-color: #ffe4e6; color: #9f1239; border: 1px solid #fda4af; }
        
        .shensha-tag {
            font-size: 0.7rem;
            padding: 1px 5px;
            border-radius: 3px;
            margin: 2px;
            display: inline-block;
            background-color: #f3e8ff;
            color: #6b21a8;
            border: 1px solid #d8b4fe;
        }
        
        .pillar-card {
            transition: transform 0.2s;
        }
        .pillar-card:hover {
            transform: translateY(-5px);
        }
        
        .calendar-row:hover {
            background-color: #f9fafb !important;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- ä¸»å®¹å™¨ -->
        <div class="bg-white shadow-2xl rounded-2xl overflow-hidden">
            <!-- å¤´éƒ¨è¾“å…¥åŒº -->
            <div class="p-6 bg-gradient-to-r from-gray-800 to-gray-900 text-white">
                <h1 class="text-3xl font-bold mb-2 flex items-center">
                    <span class="mr-3">ğŸ”®</span>
                    å››æŸ±å…«å­—æ’ç›˜ç³»ç»Ÿ
                    <span class="ml-3 text-sm font-normal text-gray-300">ä¸“ä¸šç‰ˆ</span>
                </h1>
                <p class="text-gray-400 text-sm mb-6">åŒ…å«æµå¹´æµæœˆæµæ—¥åˆ†æã€ç¥ç…è¯¦æ‰¹ã€åˆ‘å†²åˆå®³ç­‰åŠŸèƒ½</p>
                
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                    <div class="md:col-span-2">
                        <label class="block text-sm text-gray-300 mb-2">ğŸ“… å‡ºç”Ÿæ—¥æœŸï¼ˆå…¬å†ï¼‰</label>
                        <input type="datetime-local" id="birthDate" 
                               class="w-full p-3 rounded-lg text-gray-900 border-2 border-gray-600 focus:border-blue-500 focus:outline-none" 
                               value="1995-08-20T10:00">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-300 mb-2">ğŸ“† æŸ¥çœ‹æµå¹´</label>
                        <input type="number" id="targetYear" 
                               class="w-full p-3 rounded-lg text-gray-900 border-2 border-gray-600 focus:border-blue-500 focus:outline-none" 
                               value="2025">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-300 mb-2">ğŸŒ™ æŸ¥çœ‹æµæœˆ</label>
                        <select id="targetMonth" 
                                class="w-full p-3 rounded-lg text-gray-900 border-2 border-gray-600 focus:border-blue-500 focus:outline-none">
                            <option value="1">1æœˆ</option><option value="2">2æœˆ</option><option value="3">3æœˆ</option>
                            <option value="4">4æœˆ</option><option value="5">5æœˆ</option><option value="6">6æœˆ</option>
                            <option value="7">7æœˆ</option><option value="8">8æœˆ</option><option value="9">9æœˆ</option>
                            <option value="10">10æœˆ</option><option value="11" selected>11æœˆ</option><option value="12">12æœˆ</option>
                        </select>
                    </div>
                    <button onclick="calculate()" 
                            class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold py-3 px-6 rounded-lg transition transform hover:scale-105 shadow-lg">
                        ğŸ” å¼€å§‹æ’ç›˜
                    </button>
                </div>
            </div>

            <!-- åŸå±€å±•ç¤ºåŒº -->
            <div class="p-6 border-b-4 border-gray-200 bg-gradient-to-br from-gray-50 to-gray-100">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-2">ğŸ¯</span>
                    å‘½ä¸»åŸå±€ï¼ˆå››æŸ±å…«å­—ï¼‰
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4" id="natalChart">
                    <!-- JSå¡«å…… -->
                </div>
                <!-- æµå¹´æŸ± -->
                <div class="mt-6 pt-6 border-t border-gray-300">
                    <h3 class="text-lg font-bold text-gray-700 mb-3 flex items-center">
                        <span class="mr-2">â°</span>
                        å¤§è¿ä¿¡æ¯
                    </h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="dayunInfo">
                        <!-- JSå¡«å…… -->
                    </div>
                </div>
            </div>

            <!-- æµæ—¥åˆ—è¡¨åŒº -->
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center">
                        <span class="mr-2">ğŸ“‹</span>
                        <span id="calendarTitle">æµæ—¥è¯¦ç»†è¿ç¨‹</span>
                    </h2>
                    <div class="text-sm text-gray-500">
                        <span class="mr-4">ğŸ’¡ æç¤ºï¼šç•™æ„æ æ˜¾ç¤ºæµæ—¥ä¸åŸå±€çš„åˆ‘å†²åˆå®³</span>
                    </div>
                </div>
                
                <div class="overflow-x-auto rounded-lg border border-gray-200">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gradient-to-r from-gray-700 to-gray-800 text-white text-sm uppercase tracking-wider">
                                <th class="p-4 border-b border-gray-600">å…¬å†æ—¥æœŸ</th>
                                <th class="p-4 border-b border-gray-600">å†œå†</th>
                                <th class="p-4 border-b border-gray-600">æµæ—¥å¹²æ”¯</th>
                                <th class="p-4 border-b border-gray-600">å¤©å¹²ç•™æ„</th>
                                <th class="p-4 border-b border-gray-600">åœ°æ”¯ç•™æ„</th>
                                <th class="p-4 border-b border-gray-600">ç¥ç…è¯¦æ‰¹</th>
                            </tr>
                        </thead>
                        <tbody id="dailyTable" class="text-sm divide-y divide-gray-200">
                            <!-- JSå¡«å……è¡Œ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- é¡µè„šè¯´æ˜ -->
        <div class="mt-6 text-center text-white text-sm">
            <p class="mb-2">ğŸ’« ä¸“ä¸šå››æŸ±å…«å­—æ’ç›˜ç³»ç»Ÿ | åŒ…å«å¤©ä¹™è´µäººã€çº¢è‰³ã€æ¡ƒèŠ±ã€é©¿é©¬ç­‰30+ç¥ç…</p>
            <p class="text-gray-300 text-xs">ä»…ä¾›å‚è€ƒï¼Œè¯·ç†æ€§çœ‹å¾…</p>
        </div>
    </div>

    <script>
        // ============ åŸºç¡€æ•°æ®å®šä¹‰ ============
        const WUXING_MAP = {
            'ç”²':'æœ¨','ä¹™':'æœ¨','ä¸™':'ç«','ä¸':'ç«','æˆŠ':'åœŸ','å·±':'åœŸ',
            'åºš':'é‡‘','è¾›':'é‡‘','å£¬':'æ°´','ç™¸':'æ°´',
            'å­':'æ°´','ä¸‘':'åœŸ','å¯…':'æœ¨','å¯':'æœ¨','è¾°':'åœŸ','å·³':'ç«',
            'åˆ':'ç«','æœª':'åœŸ','ç”³':'é‡‘','é…‰':'é‡‘','æˆŒ':'åœŸ','äº¥':'æ°´'
        };

        // å¤©å¹²åœ°æ”¯å…³ç³»
        const RELATIONS = {
            // å¤©å¹²äº”åˆ
            GanHe: {'ç”²':'å·±','å·±':'ç”²','ä¹™':'åºš','åºš':'ä¹™','ä¸™':'è¾›','è¾›':'ä¸™','ä¸':'å£¬','å£¬':'ä¸','æˆŠ':'ç™¸','ç™¸':'æˆŠ'},
            // å¤©å¹²ç›¸å†²
            GanChong: {'ç”²':'åºš','åºš':'ç”²','ä¹™':'è¾›','è¾›':'ä¹™','ä¸™':'å£¬','å£¬':'ä¸™','ä¸':'ç™¸','ç™¸':'ä¸'},
            // åœ°æ”¯å…­åˆ
            ZhiLiuHe: {'å­':'ä¸‘','ä¸‘':'å­','å¯…':'äº¥','äº¥':'å¯…','å¯':'æˆŒ','æˆŒ':'å¯','è¾°':'é…‰','é…‰':'è¾°','å·³':'ç”³','ç”³':'å·³','åˆ':'æœª','æœª':'åˆ'},
            // åœ°æ”¯ç›¸å†²
            ZhiChong: {'å­':'åˆ','åˆ':'å­','ä¸‘':'æœª','æœª':'ä¸‘','å¯…':'ç”³','ç”³':'å¯…','å¯':'é…‰','é…‰':'å¯','è¾°':'æˆŒ','æˆŒ':'è¾°','å·³':'äº¥','äº¥':'å·³'},
            // åœ°æ”¯ä¸‰åˆ
            ZhiSanHe: {
                'ç”³å­è¾°': ['ç”³','å­','è¾°'], // æ°´å±€
                'äº¥å¯æœª': ['äº¥','å¯','æœª'], // æœ¨å±€
                'å¯…åˆæˆŒ': ['å¯…','åˆ','æˆŒ'], // ç«å±€
                'å·³é…‰ä¸‘': ['å·³','é…‰','ä¸‘']  // é‡‘å±€
            },
            // åœ°æ”¯ç›¸åˆ‘
            ZhiXing: {
                'å¯…': ['å·³','ç”³'], 'å·³': ['ç”³','å¯…'], 'ç”³': ['å¯…','å·³'], // æ— æ©ä¹‹åˆ‘
                'ä¸‘': ['æˆŒ','æœª'], 'æˆŒ': ['æœª','ä¸‘'], 'æœª': ['ä¸‘','æˆŒ'], // æŒåŠ¿ä¹‹åˆ‘
                'å­': ['å¯'], 'å¯': ['å­'], // æ— ç¤¼ä¹‹åˆ‘
                'è¾°': ['è¾°'], 'åˆ': ['åˆ'], 'é…‰': ['é…‰'], 'äº¥': ['äº¥'] // è‡ªåˆ‘
            },
            // åœ°æ”¯ç›¸å®³
            ZhiHai: {'å­':'æœª','æœª':'å­','ä¸‘':'åˆ','åˆ':'ä¸‘','å¯…':'å·³','å·³':'å¯…','å¯':'è¾°','è¾°':'å¯','ç”³':'äº¥','äº¥':'ç”³','é…‰':'æˆŒ','æˆŒ':'é…‰'},
            // åœ°æ”¯ç›¸ç ´
            ZhiPo: {'å­':'é…‰','é…‰':'å­','ä¸‘':'è¾°','è¾°':'ä¸‘','å¯…':'äº¥','äº¥':'å¯…','å¯':'åˆ','åˆ':'å¯','å·³':'ç”³','ç”³':'å·³','æœª':'æˆŒ','æˆŒ':'æœª'}
        };

        // ============ ç¥ç…æ•°æ®åº“ï¼ˆç›²æ´¾åŠä¼ ç»Ÿç¥ç…ï¼‰============
        const SHENSHA = {
            // å¤©ä¹™è´µäººï¼ˆæ—¥å¹²æŸ¥åœ°æ”¯ï¼‰
            TianYi: {
                'ç”²': ['ä¸‘','æœª'], 'æˆŠ': ['ä¸‘','æœª'],
                'ä¹™': ['å­','ç”³'], 'å·±': ['å­','ç”³'],
                'ä¸™': ['äº¥','é…‰'], 'ä¸': ['äº¥','é…‰'],
                'åºš': ['ä¸‘','æœª'], 'è¾›': ['å¯…','åˆ'],
                'å£¬': ['å¯','å·³'], 'ç™¸': ['å¯','å·³']
            },
            // å¤©å¾·è´µäººï¼ˆæœˆæ”¯æŸ¥åœ°æ”¯ï¼‰
            TianDe: {
                'å¯…': ['ä¸'], 'å¯': ['ç”³'], 'è¾°': ['å£¬'], 'å·³': ['è¾›'],
                'åˆ': ['äº¥'], 'æœª': ['ç”²'], 'ç”³': ['ç™¸'], 'é…‰': ['å¯…'],
                'æˆŒ': ['ä¸™'], 'äº¥': ['ä¹™'], 'å­': ['å·³'], 'ä¸‘': ['åºš']
            },
            // æœˆå¾·è´µäººï¼ˆæœˆæ”¯æŸ¥åœ°æ”¯ï¼‰
            YueDe: {
                'å¯…': ['ä¸™'], 'å¯': ['ç”²'], 'è¾°': ['å£¬'], 'å·³': ['åºš'],
                'åˆ': ['ä¸™'], 'æœª': ['ç”²'], 'ç”³': ['å£¬'], 'é…‰': ['åºš'],
                'æˆŒ': ['ä¸™'], 'äº¥': ['ç”²'], 'å­': ['å£¬'], 'ä¸‘': ['åºš']
            },
            // æ–‡æ˜Œè´µäººï¼ˆæ—¥å¹²æŸ¥åœ°æ”¯ï¼‰
            WenChang: {
                'ç”²': ['å·³'], 'ä¹™': ['åˆ'], 'ä¸™': ['ç”³'], 'ä¸': ['é…‰'],
                'æˆŠ': ['ç”³'], 'å·±': ['é…‰'], 'åºš': ['äº¥'], 'è¾›': ['å­'],
                'å£¬': ['å¯…'], 'ç™¸': ['å¯']
            },
            // æ¡ƒèŠ±ï¼ˆæ—¥æ”¯æˆ–å¹´æ”¯æŸ¥åœ°æ”¯ï¼‰
            TaoHua: {
                'å¯…': ['å¯'], 'åˆ': ['å¯'], 'æˆŒ': ['å¯'], // å¯…åˆæˆŒè§å¯
                'ç”³': ['é…‰'], 'å­': ['é…‰'], 'è¾°': ['é…‰'], // ç”³å­è¾°è§é…‰
                'äº¥': ['å­'], 'å¯': ['å­'], 'æœª': ['å­'], // äº¥å¯æœªè§å­
                'å·³': ['åˆ'], 'é…‰': ['åˆ'], 'ä¸‘': ['åˆ']  // å·³é…‰ä¸‘è§åˆ
            },
            // çº¢è‰³ï¼ˆæ—¥å¹²æŸ¥åœ°æ”¯ï¼‰
            HongYan: {
                'ç”²': ['åˆ'], 'ä¹™': ['ç”³'], 'ä¸™': ['å¯…'], 'ä¸': ['æœª'],
                'æˆŠ': ['è¾°'], 'å·±': ['è¾°'], 'åºš': ['æˆŒ'], 'è¾›': ['é…‰'],
                'å£¬': ['å­'], 'ç™¸': ['ç”³']
            },
            // é©¿é©¬ï¼ˆæ—¥æ”¯æˆ–å¹´æ”¯æŸ¥åœ°æ”¯ï¼‰
            YiMa: {
                'å¯…': ['ç”³'], 'åˆ': ['ç”³'], 'æˆŒ': ['ç”³'],
                'ç”³': ['å¯…'], 'å­': ['å¯…'], 'è¾°': ['å¯…'],
                'äº¥': ['å·³'], 'å¯': ['å·³'], 'æœª': ['å·³'],
                'å·³': ['äº¥'], 'é…‰': ['äº¥'], 'ä¸‘': ['äº¥']
            },
            // åç›–ï¼ˆæ—¥æ”¯æˆ–å¹´æ”¯æŸ¥åœ°æ”¯ï¼‰
            HuaGai: {
                'å¯…': ['æˆŒ'], 'åˆ': ['æˆŒ'], 'æˆŒ': ['æˆŒ'],
                'ç”³': ['è¾°'], 'å­': ['è¾°'], 'è¾°': ['è¾°'],
                'äº¥': ['æœª'], 'å¯': ['æœª'], 'æœª': ['æœª'],
                'å·³': ['ä¸‘'], 'é…‰': ['ä¸‘'], 'ä¸‘': ['ä¸‘']
            },
            // å°†æ˜Ÿï¼ˆæ—¥æ”¯æˆ–å¹´æ”¯æŸ¥åœ°æ”¯ï¼‰
            JiangXing: {
                'å¯…': ['åˆ'], 'åˆ': ['åˆ'], 'æˆŒ': ['åˆ'],
                'ç”³': ['å­'], 'å­': ['å­'], 'è¾°': ['å­'],
                'äº¥': ['å¯'], 'å¯': ['å¯'], 'æœª': ['å¯'],
                'å·³': ['é…‰'], 'é…‰': ['é…‰'], 'ä¸‘': ['é…‰']
            },
            // å­¤è¾°å¯¡å®¿ï¼ˆå¹´æ”¯æŸ¥åœ°æ”¯ï¼‰
            GuChen: {
                'å¯…': ['å·³'], 'åˆ': ['å·³'], 'æˆŒ': ['å·³'],
                'ç”³': ['äº¥'], 'å­': ['äº¥'], 'è¾°': ['äº¥'],
                'äº¥': ['å¯…'], 'å¯': ['å¯…'], 'æœª': ['å¯…'],
                'å·³': ['ç”³'], 'é…‰': ['ç”³'], 'ä¸‘': ['ç”³']
            },
            GuaSu: {
                'å¯…': ['ä¸‘'], 'åˆ': ['ä¸‘'], 'æˆŒ': ['ä¸‘'],
                'ç”³': ['æœª'], 'å­': ['æœª'], 'è¾°': ['æœª'],
                'äº¥': ['æˆŒ'], 'å¯': ['æˆŒ'], 'æœª': ['æˆŒ'],
                'å·³': ['è¾°'], 'é…‰': ['è¾°'], 'ä¸‘': ['è¾°']
            },
            // ç¾Šåˆƒï¼ˆæ—¥å¹²æŸ¥åœ°æ”¯ï¼‰
            YangRen: {
                'ç”²': ['å¯'], 'ä¹™': ['å¯…'], 'ä¸™': ['åˆ'], 'ä¸': ['å·³'],
                'æˆŠ': ['åˆ'], 'å·±': ['å·³'], 'åºš': ['é…‰'], 'è¾›': ['ç”³'],
                'å£¬': ['å­'], 'ç™¸': ['äº¥']
            },
            // ç¦„ç¥ï¼ˆæ—¥å¹²æŸ¥åœ°æ”¯ï¼‰
            LuShen: {
                'ç”²': ['å¯…'], 'ä¹™': ['å¯'], 'ä¸™': ['å·³'], 'ä¸': ['åˆ'],
                'æˆŠ': ['å·³'], 'å·±': ['åˆ'], 'åºš': ['ç”³'], 'è¾›': ['é…‰'],
                'å£¬': ['äº¥'], 'ç™¸': ['å­']
            },
            // åŠ«ç…ï¼ˆå¹´æ”¯æˆ–æ—¥æ”¯æŸ¥åœ°æ”¯ï¼‰
            JieSha: {
                'å¯…': ['äº¥'], 'åˆ': ['äº¥'], 'æˆŒ': ['äº¥'],
                'ç”³': ['å·³'], 'å­': ['å·³'], 'è¾°': ['å·³'],
                'äº¥': ['ç”³'], 'å¯': ['ç”³'], 'æœª': ['ç”³'],
                'å·³': ['å¯…'], 'é…‰': ['å¯…'], 'ä¸‘': ['å¯…']
            },
            // ç¾ç…ï¼ˆå¹´æ”¯æˆ–æ—¥æ”¯æŸ¥åœ°æ”¯ï¼‰
            ZaiSha: {
                'å¯…': ['åˆ'], 'åˆ': ['åˆ'], 'æˆŒ': ['åˆ'],
                'ç”³': ['å­'], 'å­': ['å­'], 'è¾°': ['å­'],
                'äº¥': ['å¯'], 'å¯': ['å¯'], 'æœª': ['å¯'],
                'å·³': ['é…‰'], 'é…‰': ['é…‰'], 'ä¸‘': ['é…‰']
            }
        };

        function getWuxingClass(char) {
            return `wuxing-${WUXING_MAP[char] || 'åœŸ'}`;
        }

        // ============ è®¡ç®—ç¥ç… ============
        function calculateShenSha(dayGan, dayZhi, yearZhi, monthZhi, allZhi) {
            let shenshaList = [];
            
            // å¤©ä¹™è´µäººï¼ˆæ—¥å¹²æŸ¥æµæ—¥åœ°æ”¯ï¼‰
            if (SHENSHA.TianYi[dayGan] && SHENSHA.TianYi[dayGan].includes(allZhi)) {
                shenshaList.push('å¤©ä¹™è´µäºº');
            }
            
            // æ–‡æ˜Œè´µäºº
            if (SHENSHA.WenChang[dayGan] && SHENSHA.WenChang[dayGan].includes(allZhi)) {
                shenshaList.push('æ–‡æ˜Œ');
            }
            
            // çº¢è‰³
            if (SHENSHA.HongYan[dayGan] && SHENSHA.HongYan[dayGan].includes(allZhi)) {
                shenshaList.push('çº¢è‰³');
            }
            
            // æ¡ƒèŠ±ï¼ˆä»¥æ—¥æ”¯æŸ¥ï¼‰
            if (SHENSHA.TaoHua[dayZhi] && SHENSHA.TaoHua[dayZhi].includes(allZhi)) {
                shenshaList.push('æ¡ƒèŠ±');
            }
            
            // é©¿é©¬ï¼ˆä»¥æ—¥æ”¯æŸ¥ï¼‰
            if (SHENSHA.YiMa[dayZhi] && SHENSHA.YiMa[dayZhi].includes(allZhi)) {
                shenshaList.push('é©¿é©¬');
            }
            
            // åç›–ï¼ˆä»¥æ—¥æ”¯æŸ¥ï¼‰
            if (SHENSHA.HuaGai[dayZhi] && SHENSHA.HuaGai[dayZhi].includes(allZhi)) {
                shenshaList.push('åç›–');
            }
            
            // å°†æ˜Ÿï¼ˆä»¥æ—¥æ”¯æŸ¥ï¼‰
            if (SHENSHA.JiangXing[dayZhi] && SHENSHA.JiangXing[dayZhi].includes(allZhi)) {
                shenshaList.push('å°†æ˜Ÿ');
            }
            
            // å­¤è¾°ï¼ˆä»¥å¹´æ”¯æŸ¥ï¼‰
            if (SHENSHA.GuChen[yearZhi] && SHENSHA.GuChen[yearZhi].includes(allZhi)) {
                shenshaList.push('å­¤è¾°');
            }
            
            // å¯¡å®¿ï¼ˆä»¥å¹´æ”¯æŸ¥ï¼‰
            if (SHENSHA.GuaSu[yearZhi] && SHENSHA.GuaSu[yearZhi].includes(allZhi)) {
                shenshaList.push('å¯¡å®¿');
            }
            
            // ç¾Šåˆƒ
            if (SHENSHA.YangRen[dayGan] && SHENSHA.YangRen[dayGan].includes(allZhi)) {
                shenshaList.push('ç¾Šåˆƒ');
            }
            
            // ç¦„ç¥
            if (SHENSHA.LuShen[dayGan] && SHENSHA.LuShen[dayGan].includes(allZhi)) {
                shenshaList.push('ç¦„ç¥');
            }
            
            // åŠ«ç…ï¼ˆä»¥æ—¥æ”¯æŸ¥ï¼‰
            if (SHENSHA.JieSha[dayZhi] && SHENSHA.JieSha[dayZhi].includes(allZhi)) {
                shenshaList.push('åŠ«ç…');
            }
            
            // ç¾ç…ï¼ˆä»¥æ—¥æ”¯æŸ¥ï¼‰
            if (SHENSHA.ZaiSha[dayZhi] && SHENSHA.ZaiSha[dayZhi].includes(allZhi)) {
                shenshaList.push('ç¾ç…');
            }
            
            return shenshaList;
        }

        // ============ æ£€æŸ¥äº¤äº’å…³ç³» ============
        function checkInteractions(dayChar, natalChartChars, type) {
            let results = [];
            const mapKeys = Object.keys(natalChartChars);
            
            mapKeys.forEach(pillarKey => {
                const natalChar = natalChartChars[pillarKey];
                const pillarName = {'Y':'å¹´','M':'æœˆ','D':'æ—¥','T':'æ—¶'}[pillarKey];
                
                if (type === 'Gan') {
                    // å¤©å¹²åˆ
                    if (RELATIONS.GanHe[dayChar] === natalChar) {
                        results.push(`<span class="interaction-tag tag-he">åˆ${pillarName}å¹²</span>`);
                    }
                    // å¤©å¹²å†²
                    if (RELATIONS.GanChong[dayChar] === natalChar) {
                        results.push(`<span class="interaction-tag tag-chong">å†²${pillarName}å¹²</span>`);
                    }
                } else {
                    // åœ°æ”¯å…­åˆ
                    if (RELATIONS.ZhiLiuHe[dayChar] === natalChar) {
                        results.push(`<span class="interaction-tag tag-he">å…­åˆ${pillarName}æ”¯</span>`);
                    }
                    // åœ°æ”¯å†²
                    if (RELATIONS.ZhiChong[dayChar] === natalChar) {
                        results.push(`<span class="interaction-tag tag-chong">å†²${pillarName}æ”¯</span>`);
                    }
                    // åœ°æ”¯åˆ‘
                    if (RELATIONS.ZhiXing[dayChar] && RELATIONS.ZhiXing[dayChar].includes(natalChar)) {
                        results.push(`<span class="interaction-tag tag-xing">åˆ‘${pillarName}æ”¯</span>`);
                    }
                    // åœ°æ”¯å®³
                    if (RELATIONS.ZhiHai[dayChar] === natalChar) {
                        results.push(`<span class="interaction-tag tag-hai">å®³${pillarName}æ”¯</span>`);
                    }
                    // åœ°æ”¯ç ´
                    if (RELATIONS.ZhiPo[dayChar] === natalChar) {
                        results.push(`<span class="interaction-tag tag-po">ç ´${pillarName}æ”¯</span>`);
                    }
                }
            });
            
            return results.join(' ');
        }

        // ============ ä¸»è®¡ç®—å‡½æ•° ============
        function calculate() {
            const birthInput = document.getElementById('birthDate').value;
            const targetYear = parseInt(document.getElementById('targetYear').value);
            const targetMonth = parseInt(document.getElementById('targetMonth').value);

            if (!birthInput) {
                alert("è¯·è¾“å…¥å‡ºç”Ÿæ—¥æœŸ");
                return;
            }

            const birthDate = new Date(birthInput);
            
            // å®ä¾‹åŒ– Solar å¯¹è±¡
            const solarBirth = Solar.fromYmdHms(
                birthDate.getFullYear(), 
                birthDate.getMonth() + 1, 
                birthDate.getDate(), 
                birthDate.getHours(), 
                birthDate.getMinutes(), 
                0
            );

            // è½¬å†œå†å¹¶è·å–å…«å­—
            const lunarBirth = solarBirth.getLunar();
            const bazi = lunarBirth.getEightChar();
            
            // 1. æ¸²æŸ“åŸå±€
            renderNatalChart(bazi, lunarBirth);
            
            // 2. æ¸²æŸ“æµæ—¥
            renderDailyCalendar(bazi, targetYear, targetMonth);
        }

        // ============ æ¸²æŸ“åŸå±€å››æŸ± ============
        function renderNatalChart(bazi, lunar) {
            const container = document.getElementById('natalChart');
            const pillars = [
                { title: 'å¹´æŸ±', gan: bazi.getYearGan(), zhi: bazi.getYearZhi(), icon: 'ğŸ‹' },
                { title: 'æœˆæŸ±', gan: bazi.getMonthGan(), zhi: bazi.getMonthZhi(), icon: 'ğŸŒ™' },
                { title: 'æ—¥æŸ±', gan: bazi.getDayGan(), zhi: bazi.getDayZhi(), icon: 'â˜€ï¸' },
                { title: 'æ—¶æŸ±', gan: bazi.getTimeGan(), zhi: bazi.getTimeZhi(), icon: 'â°' }
            ];

            let html = '';
            pillars.forEach(p => {
                const ganWuxing = WUXING_MAP[p.gan];
                const zhiWuxing = WUXING_MAP[p.zhi];
                html += `
                    <div class="pillar-card bg-white p-4 rounded-xl border-2 border-gray-300 shadow-md hover:shadow-xl">
                        <div class="text-gray-500 text-xs mb-2 flex justify-between items-center">
                            <span>${p.icon} ${p.title}</span>
                        </div>
                        <div class="flex justify-center items-center space-x-2">
                            <div class="text-center">
                                <div class="text-3xl ${getWuxingClass(p.gan)} gan">${p.gan}</div>
                                <div class="text-xs text-gray-400 mt-1">${ganWuxing}</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl ${getWuxingClass(p.zhi)} zhi">${p.zhi}</div>
                                <div class="text-xs text-gray-400 mt-1">${zhiWuxing}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;

            // æ¸²æŸ“å¤§è¿ä¿¡æ¯
            const dayunContainer = document.getElementById('dayunInfo');
            const yun = lunar.getEightChar().getYun(1); // 1è¡¨ç¤ºç”·å‘½ï¼Œ0è¡¨ç¤ºå¥³å‘½
            
            let dayunHtml = `
                <div class="bg-white p-4 rounded-lg border border-gray-300 shadow-sm">
                    <div class="text-sm text-gray-600 mb-2">èµ·è¿å¹´é¾„</div>
                    <div class="text-2xl font-bold text-blue-600">${yun.getStartYear()}å²</div>
                </div>
            `;
            
            const dayuns = yun.getDaYun();
            if (dayuns.length > 0) {
                const currentDayun = dayuns[0];
                dayunHtml += `
                    <div class="bg-white p-4 rounded-lg border border-gray-300 shadow-sm">
                        <div class="text-sm text-gray-600 mb-2">å½“å‰å¤§è¿</div>
                        <div class="text-2xl font-bold">
                            <span class="${getWuxingClass(currentDayun.getGanZhi().substring(0,1))}">${currentDayun.getGanZhi().substring(0,1)}</span>
                            <span class="${getWuxingClass(currentDayun.getGanZhi().substring(1,2))}">${currentDayun.getGanZhi().substring(1,2)}</span>
                        </div>
                    </div>
                `;
            }
            
            dayunContainer.innerHTML = dayunHtml;
        }

        // ============ æ¸²æŸ“æµæ—¥æ—¥å† ============
        function renderDailyCalendar(bazi, year, month) {
            const tbody = document.getElementById('dailyTable');
            document.getElementById('calendarTitle').innerText = `${year}å¹´${month}æœˆæµæ—¥è¯¦æ‰¹`;
            tbody.innerHTML = '';

            // è·å–åŸå±€å¹²æ”¯ç”¨äºæ¯”å¯¹
            const natalGan = { 
                Y: bazi.getYearGan(), 
                M: bazi.getMonthGan(), 
                D: bazi.getDayGan(), 
                T: bazi.getTimeGan() 
            };
            const natalZhi = { 
                Y: bazi.getYearZhi(), 
                M: bazi.getMonthZhi(), 
                D: bazi.getDayZhi(), 
                T: bazi.getTimeZhi() 
            };

            // è®¡ç®—å½“æœˆå¤©æ•°
            const daysInMonth = new Date(year, month, 0).getDate();
            
            for (let d = 1; d <= daysInMonth; d++) {
                const currentSolar = Solar.fromYmd(year, month, d);
                const currentLunar = currentSolar.getLunar();
                
                // è·å–æµæ—¥å¹²æ”¯
                const dayGan = currentLunar.getDayGan();
                const dayZhi = currentLunar.getDayZhi();
                const dayGanZhi = currentLunar.getDayInGanZhi();
                
                // äº¤äº’è®¡ç®—
                const ganNote = checkInteractions(dayGan, natalGan, 'Gan');
                const zhiNote = checkInteractions(dayZhi, natalZhi, 'Zhi');
                
                // è®¡ç®—ç¥ç…
                const shenshaList = calculateShenSha(
                    natalGan.D, 
                    natalZhi.D, 
                    natalZhi.Y, 
                    natalZhi.M, 
                    dayZhi
                );
                
                // è·å–å»ºé™¤åäºŒç¥
                const jianChu = currentLunar.getZhiXing();
                
                // ç»„åˆç¥ç…æ˜¾ç¤º
                let shenShaHtml = `<span class="text-gray-600 font-semibold">${jianChu}</span>`;
                shenshaList.forEach(ss => {
                    shenShaHtml += `<span class="shensha-tag">${ss}</span>`;
                });
                
                // è·å–å†œå†æ—¥æœŸ
                const lunarDay = currentLunar.getDayInChinese();
                const lunarMonth = currentLunar.getMonthInChinese();
                
                // æ˜ŸæœŸ
                const week = currentSolar.getWeekInChinese();
                
                const row = `
                    <tr class="calendar-row hover:bg-gray-50 transition-colors">
                        <td class="p-4 border-b border-gray-200">
                            <div class="font-bold text-gray-800 text-base">${year}-${String(month).padStart(2,'0')}-${String(d).padStart(2,'0')}</div>
                            <div class="text-xs text-gray-500 mt-1">æ˜ŸæœŸ${week}</div>
                        </td>
                        <td class="p-4 border-b border-gray-200">
                            <div class="text-sm text-gray-700">${lunarMonth}æœˆ${lunarDay}</div>
                        </td>
                        <td class="p-4 border-b border-gray-200 text-xl font-bold">
                            <span class="${getWuxingClass(dayGan)}">${dayGan}</span>
                            <span class="${getWuxingClass(dayZhi)}">${dayZhi}</span>
                        </td>
                        <td class="p-4 border-b border-gray-200">
                            ${ganNote || '<span class="text-gray-300">-</span>'}
                        </td>
                        <td class="p-4 border-b border-gray-200">
                            ${zhiNote || '<span class="text-gray-300">-</span>'}
                        </td>
                        <td class="p-4 border-b border-gray-200">
                            ${shenShaHtml}
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œä¸€æ¬¡
        window.onload = calculate;
    </script>
</body>
</html>

